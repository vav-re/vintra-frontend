function logout(){let e=document.getElementById("loginScreen"),t=document.getElementById("appContainer"),a=document.getElementById("password");e&&t&&(t.style.opacity="0",setTimeout(function(){t.style.display="none",e.style.display="flex",e.style.opacity="1",a&&(a.value=""),VINTRA.state.currentView=null,VINTRA.state.currentPatientId=null,VINTRA.state.currentDocumentId=null},600))}function updateNavigation(a){document.querySelectorAll(".nav-item[data-target], .sidebar-link[data-target], .mobile-menu-item[data-target]").forEach(e=>{var t=e.dataset.target===a;e.classList.toggle("active",t)})}function renderPatientSelectionOnDashboard(){var e,t,a=document.getElementById("dashboard-view");a&&((e=a.querySelector(".patient-selection-section"))||((e=document.createElement("div")).className="patient-selection-section",(t=document.createElement("div")).className="section-header",t.innerHTML='<h2 class="section-title">Aceder Paciente</h2>',e.appendChild(t),(t=document.createElement("div")).className="search-container dashboard-search",t.innerHTML=`
            <div class="search-bar">
                <i class="fas fa-search search-icon"></i>
                <input type="text" id="dashboardPatientSearch" placeholder="Buscar paciente por nome ou ID..." class="search-input">
            </div>
        `,e.appendChild(t),(t=document.createElement("div")).id="dashboardPatientList",t.className="patient-card-list",e.appendChild(t),a.appendChild(e)),renderPatientList())}function renderPatientList(t=""){let a=document.getElementById("dashboardPatientList");var e;a&&(a.innerHTML="",0===(e=VINTRA.state.recentPatients.filter(e=>!t||e.name.toLowerCase().includes(t.toLowerCase())||e.id.includes(t))).length?a.innerHTML='<p class="empty-list-message">Nenhum paciente encontrado.</p>':(e.forEach(t=>{var e=document.createElement("div");e.className="patient-card dashboard-patient-card",e.dataset.id=t.id,e.innerHTML=`
            <div class="patient-card-header">
                <div class="patient-avatar">${t.name.charAt(0)}</div>
                <div class="patient-card-name">${escapeHtml(t.name)}</div>
            </div>
            <div class="patient-card-info">ID: ${escapeHtml(t.id)}</div>
            <button class="btn btn-sm btn-primary access-patient-btn" data-patient-id="${t.id}">Aceder</button>
        `,e.querySelector(".access-patient-btn").addEventListener("click",function(e){e.stopPropagation(),openPatientPanel(t.id)}),a.appendChild(e)}),(e=document.getElementById("dashboardPatientSearch"))&&e.addEventListener("input",function(){renderPatientList(this.value)})))}function openPatientPanel(t){var e,a,n=VINTRA.state.recentPatients.find(e=>e.id===t);n?(console.log(`Abrindo painel para paciente: ${n.name} (ID: ${t})`),VINTRA.state.currentPatientId=t,e=document.querySelector("#patient-view .patient-name"),a=document.querySelector("#patient-view .patient-details"),e&&(e.textContent=n.name),a&&(a.textContent=`${n.age} anos • ${n.gender} • Prontuário #`+t.replace("patient-","")),window.switchView("patient")):showToast("error","Erro","Paciente não encontrado.")}function escapeHtml(e){return e.toString().replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;")}function showToast(e,t,a,n=5e3){let i=document.getElementById("toastContainer"),s=(i||((i=document.createElement("div")).id="toastContainer",i.className="toast-container",document.body.appendChild(i)),document.createElement("div")),o=(s.className="toast toast-"+e,"fas fa-info-circle");"success"===e?o="fas fa-check-circle":"error"===e?o="fas fa-times-circle":"warning"===e&&(o="fas fa-exclamation-triangle"),s.innerHTML=`
        <div class="toast-icon ${e}"> <i class="${o}"></i> </div>
        <div class="toast-content">
            <div class="toast-title">${escapeHtml(t)}</div>
            <div class="toast-message">${escapeHtml(a)}</div>
        </div>
        <button class="toast-close"> <i class="fas fa-times"></i> </button>
    `,s.querySelector(".toast-close").addEventListener("click",function(){removeToast(s)}),i.appendChild(s),setTimeout(()=>s.style.opacity="1",10),setTimeout(()=>removeToast(s),n)}function removeToast(e){e.style.opacity="0",setTimeout(()=>e.remove(),300)}window.VINTRA={state:{currentView:null,currentPatientId:null,currentDocumentId:null,documents:[],recentPatients:[],isInitialized:!1},init:function(){this.state.isInitialized||("loading"===document.readyState?document.addEventListener("DOMContentLoaded",()=>this.initialize()):this.initialize())},initialize:function(){console.log("VINTRA Inicializando..."),this.loadDemoData(),this.setupEventListeners(),this.state.isInitialized=!0;var e=document.getElementById("loginScreen"),t=document.getElementById("appContainer");e&&t&&(e.classList.add("visible"),t.style.display="none")},loadDemoData:function(){this.state.recentPatients=[{id:"patient-1",name:"Maria Silva",age:38,gender:"Feminino",lastVisit:"28/03/2025",status:"Em tratamento"},{id:"patient-2",name:"João Santos",age:42,gender:"Masculino",lastVisit:"25/03/2025",status:"Primeira consulta"},{id:"patient-3",name:"Ana Oliveira",age:29,gender:"Feminino",lastVisit:"20/03/2025",status:"Em tratamento"},{id:"patient-4",name:"Carlos Pereira",age:55,gender:"Masculino",lastVisit:"15/03/2025",status:"Retorno"}],this.state.documents=[{id:"doc1",patientId:"patient-1",title:"Entrevista_Maria_2503.mp3",type:"audio",date:"25/03/2025",time:"10:30",icon:"fas fa-microphone",color:"var(--accent-vivid)",size:"15.3 MB",duration:"28:45"},{id:"doc2",patientId:"patient-1",title:"Transcrição_Maria_2503.txt",type:"transcription",date:"25/03/2025",time:"10:35",icon:"fas fa-file-alt",color:"var(--accent)",size:"5 KB"}],console.log("Dados de demonstração carregados.")},setupEventListeners:function(){this.setupLogin(),this.setupNavigation(),document.querySelectorAll("[data-target]").forEach(e=>{e.addEventListener("click",function(){var e=this.dataset.target;window.switchView(e)})})},setupLogin:function(){var e=document.getElementById("loginForm");let t=document.getElementById("password"),a=document.getElementById("passwordError"),n=document.getElementById("loginScreen"),i=document.getElementById("appContainer");e&&t&&a&&n&&i?e.addEventListener("submit",function(e){e.preventDefault(),"123"===t.value?(a.style.display="none",showToast("success","Login bem-sucedido","Bem-vindo ao VINTRA!"),n.style.opacity="0",setTimeout(function(){n.style.display="none",i.style.display="flex",i.style.opacity="1",VINTRA.state.currentView=null,window.switchView("dashboard"),setTimeout(function(){var e=document.getElementById("dashboard-view");e&&(e.style.display="block",e.classList.add("active"),renderPatientSelectionOnDashboard())},300)},600)):(a.style.display="block",t.focus(),t.select())}):console.error("Elementos de login não encontrados")},setupNavigation:function(){document.body.addEventListener("click",function(e){var t=e.target.closest("[data-target]");t?.dataset.target&&(e.preventDefault(),"sair"===(e=t.dataset.target)?logout():VINTRA.state.currentView!==e&&window.switchView(e))})}},VINTRA.init(),window.switchView=function(e){console.log("Trocando para view: "+e);var t=document.getElementById(e+"-view");t?(document.querySelectorAll(".workspace").forEach(function(e){e.style.display="none",e.classList.remove("active")}),t.style.display="library"===e?"flex":"block",t.classList.add("active"),"dashboard"===e&&renderPatientSelectionOnDashboard(),updateNavigation(VINTRA.state.currentView=e)):console.error(`View não encontrada: ${e}-view`)},window.openPatientPanel=openPatientPanel,window.showToast=showToast;